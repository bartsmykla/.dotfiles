#!/usr/bin/env bash
# Pre-push hook - Run tests before pushing
#
# Runs smart test suite that only tests changed files for faster feedback.
# Use 'task test' to run full test suite manually.
# Install: task hooks:install

set -euo pipefail

echo "▶ Running pre-push checks..."

# Check if task is available
if ! command -v task &>/dev/null; then
    echo "⚠️  Task not found. Skipping pre-push checks."
    echo "   Install via: brew install go-task"
    exit 0
fi

# Run smart tests (only tests for changed files)
if ! task test:changed; then
    echo ""
    echo "❌ Pre-push checks failed!"
    echo "   Fix the errors above and try again."
    echo "   Or skip with: git push --no-verify"
    exit 1
fi

echo "✓ Pre-push checks passed"
exit 0
