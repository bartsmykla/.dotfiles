{{ $email := promptStringOnce . "email" "Email address" -}}
{{ $name := promptStringOnce . "name" "Full name" -}}
{{ $osid := .chezmoi.os -}}
{{ if hasKey .chezmoi.osRelease "id" -}}
{{ $osid = printf "%s-%s" .chezmoi.os .chezmoi.osRelease.id -}}
{{- end }}

# Chezmoi Configuration
# https://www.chezmoi.io/reference/configuration-file/

# Encryption method
encryption = "age"

# Source directory (set from chezmoi init --source flag)
sourceDir = {{ .chezmoi.sourceDir | quote }}

# Data available in templates
[data]
    email = {{ $email | quote }}
    name = {{ $name | quote }}
    osid = {{ $osid | quote }}

# Editor configuration
[edit]
    command = "vim"
    args = []

# Git configuration
[git]
    # Don't auto-commit changes (manual control preferred)
    autoCommit = false
    # Don't auto-push changes (manual control preferred)
    autoPush = false

# File addition behavior
[add]
    # Don't automatically encrypt files when adding
    encrypt = false
    # Warn about potential secrets in files
    secrets = "warning"
    # Don't template symlinks
    templateSymlinks = false

# Diff configuration
[diff]
    # Use external diff tool for better readability
    command = "vim"
    args = ["-d", "{{ "{{ .Destination }}" }}", "{{ "{{ .Target }}" }}"]
    # Pager for viewing diffs
    pager = "less"

# Age encryption configuration
[age]
    # Identity file for decryption
    identity = "~/.config/chezmoi/key.txt"
    # Recipients for encryption (personal + CI)
    recipients = [
        "age1c459u9ehvrjrsh6v2sun69mw3p6apuku8cjh9q8eeax2etr439pshvnn4z",
        "age1h3cwe6tflreqda3dqkv2qucgzswkwp8w39nqt7089tw6kmpfn9sqmln47m"
    ]

# Merge configuration
[merge]
    command = "vimdiff"
    args = ["{{ "{{ .Destination }}" }}", "{{ "{{ .Source }}" }}", "{{ "{{ .Target }}" }}"]
